# 要件定義書

## 概要

マイ・ポケふたコレクションは、日本全国のポケモンマンホール（ポケふた）の写真を収集・管理・共有するためのWebアプリケーションです。ユーザーはiPhone Safariを使用してポケふたの写真を撮影・アップロードし、OpenStreetMap上で位置情報と共に表示・閲覧できます。

## 用語集

- **システム**: マイ・ポケふたコレクションアプリケーション
- **ユーザー**: iPhoneでアプリを使用するポケふた収集者
- **ポケふた**: ポケモンデザインのマンホール蓋
- **写真アップロード機能**: GPS情報付きの写真アップロード機能
- **マップ表示機能**: OpenStreetMap上での写真表示機能
- **サムネイル**: 32ピクセル程度の小さな画像表示
- **写真詳細表示機能**: 写真の詳細表示機能

## 要件

### 要件1: 写真アップロード機能

**ユーザーストーリー:** ポケふた収集者として、GPS情報付きのポケモンマンホールの写真をアップロードしたい。そうすることで、自分のコレクションを構築できる。
他の人と場所を共有は考えておらず、あくまで自分のコンプリート管理のために利用する。
そのため、ツールはいくつ集めたか数も表示できる。

#### 受入基準

1. ユーザーがiPhoneから写真を選択したとき、システムは写真のメタデータからGPS座標を抽出する
2. 横 720px 以上のサイズがある JPEG 画像の場合は、横 720px (アスペクト比は元の画像を保持)に変換する
2. HEIC 画像の場合は、メタデータを保持したまま、横 720px (アスペクト比は元の画像を保持)に変換する
2. 写真にGPSメタデータが含まれない場合は、OpenStreetMapで座標をポイントできるウィザードを表示する
3. ユーザーが写真をアップロードしたとき、システムは画像ファイルをS3バケットに保存する
4. 写真アップロードする前に、システムは写真にGPSメタデータが含まれていることを検証する
5. 写真にGPS情報が含まれていない場合、システムはアップロードを拒否し、OpenStreetMapで座標をポイントするようウィザードを表示し、ユーザーにポイントを促す
6. 写真をアップロードする前に、システムは32ピクセルのサムネイル画像を作成する
7. 写真がアップロードされたとき、同時にサムネイル画像もアップロードする
8. 写真がアップロードされたら、システムはGPS座標とS3パス、撮影日時をAppSync GraphQL経由でDynamoDBに保存する

### 要件2: マップ表示機能

**ユーザーストーリー:** ポケふた収集者として、日本地図上にアップロードされたすべてのポケふた写真を表示したい。そうすることで、新しい場所を発見し、コレクションの進捗を追跡できる。

#### 受入基準

1. ページをロードする際に、DynamoDBから全てのGPS情報を取得する
2. マップが読み込まれたとき、システムは日本全国をカバーするOpenStreetMapを表示する
3. データベースから取得したGPS情報が存在するとき、システムは各写真の位置にサムネイルまたはピンマーカーを表示する
4. マーカーを表示するとき、システムは32ピクセルのサムネイルまたは特徴的なピンアイコンを使用するが、要件的に難しい場合はピンマーカーのみでも良しとする
5. 複数の写真が存在するとき、システムはすべてのマーカーをマップ上に同時に表示する
6. マップはピンが含まれる範囲をズームまたはパンする
7. されたとき、システムはマーカーの可視性とパフォーマンスを維持する

### 要件3: 写真詳細表示機能

**ユーザーストーリー:** ポケふた収集者として、マップマーカーをクリックしてフルサイズの写真と撮影日を表示したい。そうすることで、ポケふたの詳細を確認し、いつ見つけたかを思い出すことができる。

#### 受入基準

1. ユーザーがマップマーカーをクリックしたとき、システムは関連する写真の詳細表示を行う
2. 写真詳細を表示するとき、システムはS3からフルサイズの画像を表示する
3. 写真詳細を表示するとき、システムは写真メタデータから抽出した撮影日を表示する
4. 詳細表示が開いているとき、システムは閉じてマップに戻る方法を提供する
5. 写真詳細を読み込むとき、システムは読み込み状態を適切に処理する

### 要件4: データ管理機能

**ユーザーストーリー:** システム管理者として、信頼性の高いデータ保存と取得を行いたい。そうすることで、ユーザーの写真と位置データが保持され、アクセス可能になる。

#### 受入基準

1. 写真メタデータを保存するとき、システムはAppSync GraphQLミューテーションを使用してDynamoDBに書き込む
2. 写真データを取得するとき、システムはDynamoDBからAppSync GraphQLクエリを使用する
3. S3の写真にアクセスするとき、システムは安全で時間制限付きのURLを使用する
4. データベース操作を処理するとき、システムは適切なエラーハンドリングとリトライロジックを実装する
5. データを管理するとき、システムは正確なマッピングのために十分な精度でGPS座標を保存する

### 要件5: モバイル対応機能

**ユーザーストーリー:** iPhoneユーザーとして、Safari mobileでアプリがスムーズに動作してほしい。そうすることで、ポケふたを探しながら旅行中にアプリを使用できる。

#### 受入基準

1. iPhone Safariでアプリにアクセスしたとき、システムはレスポンシブなモバイルフレンドリーなインターフェースを表示する
2. タッチ操作を使用するとき、システムはタップ、ピンチ、スワイプジェスチャーに適切に応答する
3. 写真をアップロードするとき、システムはiPhoneの写真ピッカーとカメラと統合する
4. マップを表示するとき、システムはモバイルデバイス向けにパフォーマンスを最適化する
5. コンテンツを読み込むとき、システムはモバイル接続のデータ使用量と読み込み時間を最小化する

### 要件6: AWS Amplify Gen2 インフラ

**ユーザーストーリー:** 開発者として、AWS Amplify Gen2を使用してデプロイしたい。そうすることで、アプリケーションが信頼性の高いホスティングと統合されたAWSサービスを持つことができる。

#### 受入基準

1. システムはAWS Amplify Gen2プラットフォームでホストされる
2. システムはGraphQL API管理にAppSyncを使用する
3. システムはメタデータ保存にDynamoDBを使用する
4. システムは写真ファイル保存にS3を使用する
5. システムはAWSサービスに対する適切な認証と認可を実装する